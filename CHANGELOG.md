# 更新日志

[English](CHANGELOG_EN.md) | 中文

## v1.7.12

- 新增音效标签 `trigger_on_death`，用于角色死亡时自动播放音效
- 修复了在切换模型时血条的高度没有刷新的问题

## v1.7.11

- 新增模型脚步声频率配置功能，支持在 `bundleinfo.json` 中为每个模型单独配置走路和跑步时的脚步声触发频率
- 新增 `WalkSoundFrequency` 字段（可选），用于配置走路时每秒的脚步声触发频率（如果未指定，将自动使用原始角色的走路脚步声频率设置）
- 新增 `RunSoundFrequency` 字段（可选），用于配置跑步时每秒的脚步声触发频率（如果未指定，将自动使用原始角色的跑步脚步声频率设置）

## v1.7.10

- 动画器参数窗口新增目标切换功能，可以在窗口内切换查看角色自身或宠物的动画器参数
- 默认查看角色自身，可通过并排的两个按钮（角色/宠物）进行切换
- 切换目标时会自动清空参数状态，重新开始计算参数变化

## v1.7.9

- 修复了在只读环境（如 macOS）下 ModConfigs 目录无法创建导致功能失效的问题
- 当安装目录为只读时，自动切换到游戏存档的上一级目录的 ModConfigs（Windows: `AppData\LocalLow\TeamSoda\Duckov\ModConfigs`，macOS/Linux: 对应的用户数据目录）

## v1.7.8-fix2

- 改进了 Harmony Patch 的应用和移除机制，增加了备用方法以提高容错性，当主方法失败时会自动尝试备用方法

## v1.7.8

- 新增参数显示界面快捷键功能，可在设置界面中配置用于开关参数显示界面的快捷键
- 默认值为没有按键，需要用户主动在设置界面中设置
- 修复了自定义模型的显示判定逻辑，现在模型会严格遵循游戏内原生的视野范围逻辑切换显示

## v1.7.7

- 新增"所有 AI 角色"的目标设置功能，用于统一设置所有 AI 角色的默认配置项
- 优化了模型查找逻辑：优先使用单独设置，如果没有则查找`*`的设置，最后才使用原版模型
- 优化了使用自定义模型时的部分碰撞判定计算逻辑
- 修正了隐藏角色装备的情况下无法触发爆头判定的问题
- 修正了部分槽位在切换模型时会变得不可见的问题
- 修正了AI角色配置的回退逻辑，现在音频、装备隐藏等设置会根据实际使用的模型来选择配置：如果使用的是回退模型（`*`），则使用`*`的设置；如果使用的是自己的模型配置，则使用自己的设置

## v1.7.6

- 修正了获取角色单位原本模型的逻辑，现在应该能正确匹配各个类型角色的原始模型并进行处理了
- 增加了角色模型的遮挡显示处理，现在角色模型应当能在被遮挡的情况下正确显示轮廓了
- 修复了 bundleinfo.json 解析错误导致后续逻辑丢失的问题
- 现在即使某个 bundle 的 JSON 文件格式错误，也会记录错误日志并跳过该 bundle，继续处理其他正常的 bundle
- 增强了模型加载过程中的错误处理，确保单个 bundle 的错误不会影响整体功能
- 修复了模型列表界面中错误信息（如加载错误、prefab 缺失等）没有正确显示的问题
- 现在错误信息会正确显示在模型列表项中，而不仅仅是标红处理

## v1.7.5

- 新增模型音频开关功能，可在目标设置区配置是否使用模型提供的音频
- 禁用后，对应角色的所有模型音频（包括按键触发、AI 自动触发和待机音频）都不会播放
- 支持为角色、宠物和 AI 角色分别配置

## v1.7.4

- 优化了界面的结构和逻辑，以保证各个语言下的界面显示符合要求
- 增加了打开模型文件夹的按钮

## v1.7.3

- 新增 `Weather` Animator 参数（int 类型），用于获取当前天气状态（晴天、多云、雨天、风暴 I、风暴 II）
- 新增 `Time` Animator 参数（float 类型），用于获取当前 24 小时时间
- 新增 `TimePhase` Animator 参数（int 类型），用于获取当前时间阶段（白天、黎明、夜晚）
- 当 `TimeOfDayController.Instance` 不可用时，这三个参数会被设置为 -1

## v1.7.2

- 为 AnimatorParamInfo 添加了 InitialValue 属性，用于存储参数的初始值
- 修复了 ShootMode 参数的初始值（从 0 改为 -1）
- 增强了动画参数窗口的显示功能，添加了参数值变化检测和颜色高亮显示
  - 参数值改变时会显示为黄色
  - 参数值正在改变时会显示为橙色
  - 未改变的参数显示为白色
- 调整了动画参数窗口的高度（从 800 增加到 1000）和字体大小（从 13 增加到 16）

## v1.7.1

- 修改了动画器参数更新逻辑，即使没有使用自定义模型时也能看到动画参数的更新（只是不生效于animator）
- 将 CustomAnimatorControl 改为常驻实例，挂在和 ModelHandler 同一个对象上，只改目标 Animator，避免频繁创建和销毁组件
- 修复了动画参数窗口在未使用自定义模型时不显示的问题

## v1.7.0

- 在屏幕左上角添加了固定的设置按钮，点击可以打开/关闭设置界面
- 设置按钮会在主菜单或背包界面时自动显示

## v1.6.8

- 现在会自动修改模型内包含 Renderer 的对象的 layer 为 "Character"

## v1.6.7

- 修复了手持装备相关参数（如 `LeftHandEquip`、`RightHandEquip` 等）在某些情况下不会正确更新的问题
- 修复了部分 Animator 参数（如 `GunState`、`WeaponInLocator`）不会显示在参数窗口中的问题，现在所有定义的参数都会正确显示

## v1.6.6

- 新增 `GunState` Animator 参数，用于指示枪械的当前状态（射击冷却、就绪、开火、连发每发冷却、空弹、装弹中）

## v1.6.5

- 修复了 纸箱定位点 和 搬运定位点 的工作逻辑

## v1.6.4

- 新增 `WeaponInLocator` Animator 参数，用于指示武器当前所在的定位点类型（左手、右手或近战武器）

## v1.6.3

- 模型增加了 `DeathLootBoxPrefabPath` 字段，用于指定死亡战利品箱的样式（可选，默认为原版模型）
- 现在允许自定义死亡战利品箱的模型了

## v1.6.2

- 取消了对玩家角色的 idle 音频功能限制，现在玩家也可以启用自动音频了
- 增加了对每个目标角色的 idle 音频功能设置，现在可以对每个目标单独设置是否允许自动音频和自动音频间隔了
- 重构了模型管理器的 UI 界面，提升用户舒适度和界面美观度与结构化

## v1.6.1

- 新增待机音频自动播放功能，支持为非玩家角色（AI 角色和宠物）配置待机音频自动播放间隔
- 新增 idle 音效标签支持，模型音效可配置 "idle" 标签用于待机音频播放

## v1.6.0

- 优化了部分逻辑处理
- 新增纸箱定位点支持，自定义模型可包含 `PaperBoxLocator` 定位点，纸箱会自动附加到该定位点并跟随模型
- 现在隐藏装备时不再会导致纸箱被隐藏了
- 新增可搬运物品定位点支持，自定义模型可包含 `CarriableLocator` 定位点，搬运物品时会自动附加并保存原始位置信息

## v1.5.1-fix2

- 修正了重新加载模型时音频设置没有正确应用的问题

## v1.5.1-fix1

- 修正了选择模型时界面没有刷新的问题

## v1.5.1

- 新增 `AICharacter` 目标，用于非玩家和宠物的 AI 角色（暂不支持NPC，因为 NPC 实际是建筑的一部分，并非常规模型结构）
- 新增一键重置无效模型设置的按钮，用于将使用了不兼容、不存在的模型的角色快速重置回默认模型
- 新增音频播放相关接口，支持替换玩家嘎嘎和 AI 的自动嘎嘎

## v1.4.1

- 新增大量 Animator 参数支持，增强动画控制能力
- 新增枪械相关参数：`Loaded`（装弹状态）、`Shoot`（射击触发）、`ShootMode`（射击模式）、`AmmoRate`（弹药比率）
- 新增瞄准相关参数：`InAds`（瞄准状态）、`AdsValue`（瞄准进度）、`AimType`（瞄准类型）、`AimDirX/Y/Z`（瞄准方向）
- 新增动作相关参数：`ActionRunning`（动作执行状态）、`ActionProgress`（动作进度）、`ActionPriority`（动作优先级）
- 新增状态相关参数：`Hidden`（隐藏状态）、`ThermalOn`（热成像状态）、`VelocityX/Y/Z`（速度分量）
- 优化了部分代码逻辑和性能
- 增加了 Animator 参数窗口，可以实时查看支持的 Animator 参数数值

## v1.2.0

- 重构配置系统：
  - `UsingModel.json` 改为字典格式
  - 增加 `HideEquipmentConfig.json` 并将相关配置从 `UIConfig.json` 移除
  - 支持自动迁移旧配置
- 性能优化：实现增量更新机制，使用运行时哈希缓存，只在 Bundle 文件或配置变更时重新加载
- 多对象支持：每个 ModelTarget 可对应多个游戏对象，切换模型时统一应用到所有对象
- 刷新流程优化：无变更时跳过 Bundle 加载和状态检查，避免无意义的重复加载
- 临时模型恢复：Bundle 更新时自动临时切换回原版模型，更新完成后自动恢复
- 用户选择保护：刷新过程中用户更改模型时，不会覆盖用户的选择
- UI 改进：模型信息显示 Bundle 名称
- 修复刷新时模型重复加载的问题

## v1.1.2

- 优化了部分逻辑
- 增加了 `CurrentCharacterType` 参数，用于判断当前生效于玩家角色（0）还是宠物（1）

